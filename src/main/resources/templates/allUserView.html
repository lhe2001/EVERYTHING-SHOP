<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<title th:text="#{page.title.allUser.view}">유저 조회</title>
	<!-- 부트스트랩 CSS 파일 불러오기 -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css">
	<style>
		.field-error {
			border-color: #dc3545;
			color: #dc3545;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>

	<script>
		$(document).ready(function() {
			modal();

		})

		function modal(){
			const modal = document.getElementById('modal')
			if (modal) {
				modal.addEventListener('show.bs.modal', event => {
					// Button that triggered the modal
					const button = event.relatedTarget
					// Extract info from data-bs-* attributes
					const recipient = button.getAttribute('data-bs-whatever')
					// If necessary, you could initiate an Ajax request here
					// and then do the updating in a callback.

					// Update the modal's content.
					const modalTitle = modal.querySelector('.modal-title')
					const modalBodyInput = modal.querySelector('.modal-body input')

					modalTitle.textContent = `${recipient}님 반려 사유 `
					modalBodyInput.value = recipient
				})
			}
		}

		function detailView(){
			alert("ok");
		}

	</script>
</head>
<body>
	<!--모달창-->
	<div class="modal fade" id="modal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="modalLabel">반려 사유 작성:</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form>
						<div class="mb-3">
							<label for="recipient-name" class="col-form-label">신청자:</label>
							<input type="text" class="form-control" id="recipient-name">
						</div>
						<div class="mb-3">
							<label for="message-text" class="col-form-label">사유:</label>
							<textarea class="form-control" id="message-text"></textarea>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
					<button type="button" class="btn btn-primary">저장</button>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
		<!-- 상품 목록 제목 -->
		<div class="row mt-3">
			<div class="col text-center"><h2 class="font-weight-bold" th:text="#{page.title.allUser.view}">유저 조회</h2></div>
		</div>
		<form action="/home" th:action="@{/myPage/admin/allUserView}" th:object="${userSearchDTO}" method="get">
			<!-- 검색창 -->
			<div class="row mt-5">
				<div class="col-md-5">
					<div class="row">
						<div class="col">
							<select class="form-control select-sm" id="searchSelect" th:field="*{searchSelect}">
								<option value="userId">ID</option>
								<option value="userNm">이름</option>
							</select>
						</div>
						<div class="col">
							<input type="text" class="form-control" th:id="searchText" th:field="*{searchText}" th:errorclass="field-error">
						</div>
					</div>
				</div>
				<div class="col-md-2">
					<div class="d-flex justify-content-between">
						<!-- 검색 버튼 -->
						<button class="btn btn-primary btn-block" type="submit" th:text="#{button.search}">검색</button>
					</div>
				</div>
			</div>
		</form>
		<!-- 유저 목록 테이블 -->
		<div class="row mt-3">
			<div class="mt-3 col-md-12 table-responsive">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th class="text-center" style="width: 10%" th:text="#{label.member.id}">ID</th>
							<th class="text-center" style="width: 20%" th:text="#{label.member.name}">이름</th>
							<th class="text-center" style="width: 10%" th:text="#{label.grade}">등급</th>
							<th class="text-center" style="width: 10%" th:text="#{label.user.auth}">권한</th>
							<th class="text-center" style="width: 10%" th:text="#{label.used.payment}">누적 주문금액</th>
							<th class="text-center" style="width: 10%" th:text="#{label.user.regDt}">가입일</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="userInfo : ${userList}">
							<td class="text-center" th:text="${userInfo.userId}">ID</td>
							<td class="text-center">
								<a th:href="@{/myPage/admin/userInfo(userId=${userInfo.userId})}"><span th:text="${userInfo.userNm}">이름</span></a>
							</td>
							<td class="text-center" th:text="${userInfo.gradeNm}">등급</td>
							<th:block th:if="${userInfo.roleNm eq '01'}">
								<td class="text-center">
									<button type="button" class="btn btn-primary">승인</button>
									<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal"  th:attr="data-bs-whatever=${userInfo.userNm}" >반려</button>
								</td>
							</th:block>
							<th:block th:unless="${userInfo.roleNm eq '01'}">
								<td class="text-center" th:text="${userInfo.roleNm}"></td>
							</th:block>
							<td class="text-center" th:text="${userInfo.totalPayment}">누적 주문금액</td>
							<td class="text-center" th:text="${userInfo.registerDt}">가입일</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- 페이징 -->
		<nav class="mt-3" aria-label="page navigation">
			<ul class="pagination justify-content-center">
				<li class="page-item" th:classappend="${paginationInfo.currentPageNo == 1} ? disabled">
					<a class="page-link" th:href="@{/myPage/allUserView(currentPageNo=${paginationInfo.currentPageNo - 1})}"
					   th:text="#{button.previous}">
						이전
					</a>
				</li>
				<li class="page-item" th:classappend="${paginationInfo.currentPageNo == pageNo} ? active"  th:each="pageNo : ${#numbers.sequence(paginationInfo.firstPageNoOnPageList, paginationInfo.lastPageNoOnPageList)}">
					<a class="page-link" th:href="@{/myPage/allUserView(currentPageNo=${pageNo})}"
					   th:text="${pageNo}"></a>
				</li>
				<li class="page-item" th:classappend="${paginationInfo.currentPageNo == paginationInfo.totalPageCount} ? disabled">
					<a class="page-link" th:href="@{/myPage/allUserView(currentPageNo=${paginationInfo.currentPageNo + 1})}"
					   th:text="#{button.next}">
						다음
					</a>
				</li>
			</ul>
		</nav>
		<div class="row mt-3">
			<div class="col-md-7 mx-auto">
				<button class="w-100 btn btn-secondary btn-lg"
						onclick="location.href='home.html'"
						th:onclick="|location.href='@{/myPage}'|"
						type="button" th:text="#{button.previous}">이전</button>
			</div>
		</div>
	</div>
</body>
</html>
<script>



</script>